/*---------------------------------------------------------------------

Template Name: 	Administry
Version:	 	1.0
Release Date: 	July 12, 2010

File:       	administry.js
Updated:    	2010-07-12

Copyright (c) 2010 Zoran Juric - http://themeforest.net/user/zoranjuric

-----------------------------------------------------------------------

WARNING! DO NOT EDIT THIS FILE UNLESS YOU KNOW WHAT YOU ARE DOING!

---------------------------------------------------------------------*/

// 图片预加载
//imageObj = new Image();
//imgs = ["../../images/toggle.gif", "../../images/nyro/ajaxLoader.gif", "../../images/nyro/prev.gif", "../../images/nyro/next.gif"];
//for (i = 0; i <= imgs.length; i++) imageObj.src = imgs[i];

// Administry object setup
if (!Administry) var Administry = {}



// setup() - Administry init and setup
Administry.setup = function () {
    // 页面涉及到的外部链接用新窗口打开
    $('a[href^="http://"]').filter(function () {
        return this.hostname && this.hostname !== location.hostname;
    }).attr('target', '_blank');

    // setup content boxes
    if ($(".content-box").length) {
        $(".content-box header").css({
            "cursor": "s-resize"
        });
        // Give the header in content-box a different cursor	
        $(".content-box header").click(
        function () {
            $(this).parent().find('section').toggle(); // Toggle the content
            $(this).parent().toggleClass("content-box-closed"); // Toggle the class "content-box-closed" on the content
        });
    }
	
	//nyroModal弹出层设置
	$.nyroModalSettings({
		debug: false,
		processHandler: function(settings) {
			var url = settings.url;
			if (url && url.indexOf('http://www.xoyo.com') == 0) {
				$.nyroModalSettings({
					height: 855,
					width: 925
				});
			}
		},
		endShowContent: function(elts, settings) {
			$('.resizeLink', elts.contentWrapper).click(function(e) {
				e.preventDefault();
				$.nyroModalSettings({
					width: Math.random()*1000,
					height: Math.random()*1000
				});
				return false;
			});
			$('.bgLink', elts.contentWrapper).click(function(e) {
				e.preventDefault();
				$.nyroModalSettings({
					bgColor: '#'+parseInt(255*Math.random()).toString(16)+parseInt(255*Math.random()).toString(16)+parseInt(255*Math.random()).toString(16)
				});
				return false;
			});
		}
	});
    
	// 使用tooltips 替换默认的“title”属性提示  包含<a title="">、<div title="">、<span title="">
    $("a[title], div[title], span[title]").tipTip();
}

// progress() - 动画进度条 从"el" 到 "val"
Administry.progress = function (el, val, max) {
    var duration = 400;
    var span = $(el).find("span");
    var b = $(el).find("b");
    var w = Math.round((val / max) * 100);
    $(b).fadeOut('fast');
    $(span).animate({
        width: w + '%'
    }, duration, function () {
        $(el).attr("value", val);
        $(b).text(w + '%').fadeIn('fast');
    });
}

// expandableRows() - expandable table rows
Administry.expandableRows = function () {
    var titles_total = $('td.title').length;
    if (titles_total) { /* setting z-index for IE7 */
        $('td.title').each(function (i, e) {
            $(e).children('div').css('z-index', String(titles_total - i));
        });

        $('td.title').find('a:first').click(function () {
            // hide previously opened containers
            $('.opened').hide();
            // remove highlighted class from rows
            $('td.highlighted').removeClass('highlighted');

            // locate the row we clicked onto
            var tr = $(this).parents("tr");
            var div = $(this).parent().find('.listingDetails');

            if (!$(div).hasClass('opened')) {
                $(div).addClass('opened').width($(tr).width() - 2).show();
                $(tr).find('td').addClass('highlighted');
            } else {
                $(div).removeClass('opened');
                $(tr).find('td').removeClass('highlighted');
            }
            return false;
        });
    }
}


//checkbox 全选\反选方法
Administry.check_all = function () {
	var checkboxs = $('input.checkbox').length;
	if (checkboxs) {
		$('input.checkbox').click(function (){
			var type = $(this).attr('id');
			$('input[id^='+type+'_]').attr("checked",$(this).attr("checked"));
		});
	}
}

//a标签点击后confirm控制
Administry.a_confirm = function (){
	$("a[id^='confirm_']").click(function(e){
		var type = $(this).attr('confirmInfo');
		if (!confirm(type)) 
		{
			e.preventDefault();
			return false;
		}
	});
}

//新建工单时游戏分类下拉菜单，最多支持3级
Administry.show_select = function (cid, infotag){
    if(cid=='99999')
    {
        $('#mainframe').html('');
    }
    if (infotag == '4') 
    {
        return;
    }
    var obj     = $('#'+String(infotag));
    var url     = "index.php?act=selectcategory";
	$.post (url, {cid:cid,lid:infotag},
		function (msg){
			obj.html(msg);
			//将多余的子下拉干掉
			var slt_id = parseInt(infotag) + 1;
            for(; slt_id <= 3; slt_id ++) 
            {
                if($('#'+String(slt_id))) 
                {
                    $('#'+String(slt_id)).html('');
                }
            }
	});
}


//搜索游戏分类下拉菜单，最多支持3级
Administry.search_select = function (cid, infotag){
    if (infotag == '4') 
    {
        return;
    }
    var obj     = $('#'+String(infotag));
    var url     = "index.php?act=searchcategory";
	$.post (url, {cid:cid,lid:infotag},
		function (msg){
			obj.html(msg);
			//将多余的子下拉干掉
			var slt_id = parseInt(infotag) + 1;
            for(; slt_id <= 3; slt_id ++) 
            {
                if($('#'+String(slt_id))) 
                {
                    $('#'+String(slt_id)).html('');
                }
            }
	});
}

//自动弹出第一次显示
Administry.auto_select = function (cid, infotag){
    if (infotag == '4') 
    {
        return;
    }
    var obj     = $('#'+String(infotag));
    var url     = "index.php?act=searchcategory";
	$.post (url, {cid:cid,lid:infotag},
		function (msg){
			obj.html(msg);
	});
}


